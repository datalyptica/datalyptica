# ShuDL Data Lakehouse Environment Configuration
# This file contains all configurable values for the ShuDL data lakehouse stack

# =============================================================================
# Global Configuration
# =============================================================================
COMPOSE_PROJECT_NAME=shudl
NETWORK_NAME=shunetwork

# =============================================================================
# PostgreSQL Configuration
# =============================================================================
POSTGRES_DB=nessie
POSTGRES_USER=nessie
POSTGRES_PASSWORD=nessie123
POSTGRES_PORT=5432

# ShuDL Database Configuration (created automatically)
SHUDL_DB=shudl
SHUDL_USER=shudl
SHUDL_PASSWORD=password123
NESSIE_DB=nessie

# PostgreSQL Performance Settings
POSTGRES_MAX_CONNECTIONS=100
POSTGRES_SHARED_BUFFERS=128MB
POSTGRES_EFFECTIVE_CACHE_SIZE=512MB
POSTGRES_WORK_MEM=4MB
POSTGRES_MAINTENANCE_WORK_MEM=64MB
POSTGRES_WAL_LEVEL=replica
POSTGRES_MAX_WAL_SIZE=1GB
POSTGRES_MIN_WAL_SIZE=80MB
POSTGRES_CHECKPOINT_COMPLETION_TARGET=0.9

# =============================================================================
# MinIO Object Storage Configuration
# =============================================================================
MINIO_ROOT_USER=admin
MINIO_ROOT_PASSWORD=password123
MINIO_API_PORT=9000
MINIO_CONSOLE_PORT=9001
MINIO_BUCKET_NAME=lakehouse
MINIO_REGION=us-east-1

# =============================================================================
# Nessie Catalog Configuration
# =============================================================================
NESSIE_PORT=19120
NESSIE_HOST=0.0.0.0

# Nessie Database Backend
NESSIE_VERSION_STORE_TYPE=JDBC2
NESSIE_DATASOURCE_NAME=postgresql

# Warehouse Configuration
NESSIE_DEFAULT_WAREHOUSE=warehouse
NESSIE_WAREHOUSE_LOCATION=s3://lakehouse/
WAREHOUSE_LOCATION=s3://lakehouse/

# CORS Configuration
NESSIE_CORS_ENABLED=true
NESSIE_CORS_ORIGINS=*
NESSIE_CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS
NESSIE_CORS_HEADERS=accept,authorization,content-type,x-requested-with
NESSIE_CORS_EXPOSED_HEADERS=Content-Disposition
NESSIE_CORS_MAX_AGE=24H

# Database Connection Pool
NESSIE_DB_INITIAL_SIZE=2
NESSIE_DB_MIN_SIZE=2
NESSIE_DB_MAX_SIZE=10

# Nessie Database Connection (should match PostgreSQL credentials)
QUARKUS_DATASOURCE_USERNAME=nessie
QUARKUS_DATASOURCE_PASSWORD=nessie123

# =============================================================================
# Trino Query Engine Configuration
# =============================================================================
TRINO_PORT=8080
TRINO_COORDINATOR=true
TRINO_INCLUDE_COORDINATOR=true
TRINO_NODE_ENVIRONMENT=production
TRINO_QUERY_MAX_MEMORY=2GB
TRINO_MEMORY_HEAP_HEADROOM=512MB
TRINO_DISCOVERY_URI=http://trino:8080

# Trino Iceberg Catalog Configuration
TRINO_CATALOG_ICEBERG_CATALOG_TYPE=nessie
TRINO_CATALOG_ICEBERG_NESSIE_CATALOG_URI=http://nessie:19120/api/v2
TRINO_CATALOG_ICEBERG_NESSIE_CATALOG_REF=main
TRINO_CATALOG_ICEBERG_NESSIE_CATALOG_DEFAULT_WAREHOUSE_DIR=s3://lakehouse/
TRINO_CATALOG_ICEBERG_FILE_FORMAT=PARQUET
TRINO_CATALOG_ICEBERG_COMPRESSION_CODEC=SNAPPY

# =============================================================================
# Spark Compute Engine Configuration
# =============================================================================
SPARK_UI_PORT=4040
SPARK_MASTER_PORT=7077
SPARK_MODE=master

# Spark Core Configuration
SPARK_MASTER_URL=spark://shudl-spark-master:7077
SPARK_DRIVER_MEMORY=2g
SPARK_DRIVER_MAX_RESULT_SIZE=1g
SPARK_EXECUTOR_MEMORY=2g
SPARK_EXECUTOR_CORES=2
SPARK_EXECUTOR_INSTANCES=2
SPARK_WORKER_MEMORY=2G
SPARK_WORKER_CORES=2
SPARK_DYNAMIC_ALLOCATION_ENABLED=false
SPARK_SERIALIZER=org.apache.spark.serializer.KryoSerializer

# Spark SQL Adaptive Query Execution
SPARK_SQL_ADAPTIVE_ENABLED=true
SPARK_SQL_ADAPTIVE_COALESCE_PARTITIONS_ENABLED=true
SPARK_SQL_ADAPTIVE_SKEW_JOIN_ENABLED=true

# Spark Iceberg Configuration
SPARK_ICEBERG_CATALOG_NAME=iceberg
SPARK_ICEBERG_URI=http://nessie:19120/api/v2
SPARK_ICEBERG_REF=main
SPARK_ICEBERG_WAREHOUSE=s3://lakehouse/
SPARK_ICEBERG_IO_IMPL=org.apache.iceberg.aws.s3.S3FileIO

# =============================================================================
# S3/MinIO Configuration (shared across services)
# =============================================================================
S3_ENDPOINT=http://minio:9000
S3_ACCESS_KEY=admin
S3_SECRET_KEY=password123
S3_REGION=us-east-1
S3_PATH_STYLE_ACCESS=true

# Nessie URI for REST catalog
NESSIE_URI=http://nessie:19120/iceberg/main/

# =============================================================================
# Health Check Configuration
# =============================================================================
HEALTHCHECK_INTERVAL=30s
HEALTHCHECK_TIMEOUT=10s
HEALTHCHECK_RETRIES=3
HEALTHCHECK_START_PERIOD=60s

# =============================================================================
# Security Configuration (for future use)
# =============================================================================
# KEYCLOAK_ENABLED=false
# RANGER_ENABLED=false

# =============================================================================
# Additional Spark Configuration from spark-defaults.conf
# =============================================================================
# Spark UI Configuration
SPARK_UI_RETAINED_JOBS=100
SPARK_UI_RETAINED_STAGES=100
SPARK_UI_RETAINED_TASKS=100

# Spark History Server Configuration
SPARK_HISTORY_FS_LOG_DIRECTORY=s3a://lakehouse/spark-history
SPARK_HISTORY_FS_CLEANER_ENABLED=true
SPARK_HISTORY_FS_CLEANER_INTERVAL=1d
SPARK_HISTORY_FS_CLEANER_MAX_AGE=7d

# Spark Event Log Configuration
SPARK_EVENT_LOG_ENABLED=false
SPARK_EVENT_LOG_DIR=s3a://lakehouse/spark-events
SPARK_EVENT_LOG_COMPRESS=true

# Spark Network Configuration
SPARK_NETWORK_TIMEOUT=800s
SPARK_EXECUTOR_HEARTBEAT_INTERVAL=60s
SPARK_RPC_ASK_TIMEOUT=800s
SPARK_RPC_LOOKUP_TIMEOUT=800s

# Spark Shuffle Configuration
SPARK_SQL_SHUFFLE_PARTITIONS=200
SPARK_DEFAULT_PARALLELISM=200

# Spark Memory Configuration
SPARK_MEMORY_FRACTION=0.8
SPARK_MEMORY_STORAGE_FRACTION=0.3
SPARK_MEMORY_OFF_HEAP_ENABLED=false
SPARK_MEMORY_OFF_HEAP_SIZE=0

# Spark Serialization Configuration
SPARK_KRYO_SERIALIZER_BUFFER_MAX=2047m
SPARK_KRYO_REGISTRATION_REQUIRED=false

# =============================================================================
# Additional Nessie Configuration from application.properties
# =============================================================================
# Authentication Configuration
NESSIE_SERVER_AUTHENTICATION_ENABLED=false

# Logging Configuration
NESSIE_LOG_LEVEL=INFO
NESSIE_LOG_CATEGORY_ORG_PROJECTNESSIE_LEVEL=DEBUG
NESSIE_LOG_CONSOLE_ENABLE=true
NESSIE_LOG_CONSOLE_FORMAT="%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n"

# Health Check Configuration
NESSIE_HEALTH_ROOT_PATH=/health

# OpenAPI Configuration
NESSIE_SWAGGER_UI_ALWAYS_INCLUDE=true
NESSIE_SWAGGER_UI_PATH=/swagger-ui

# Metrics Configuration
NESSIE_MICROMETER_ENABLED=true
NESSIE_MICROMETER_EXPORT_PROMETHEUS_ENABLED=true

# =============================================================================
# Additional PostgreSQL Configuration
# =============================================================================
POSTGRES_SUPERUSER_RESERVED_CONNECTIONS=3
POSTGRES_LISTEN_ADDRESSES=*

# PostgreSQL Authentication Configuration (pg_hba.conf equivalent)
POSTGRES_AUTH_LOCAL=trust
POSTGRES_AUTH_HOST_IPV4=md5
POSTGRES_AUTH_HOST_IPV6=md5
POSTGRES_AUTH_REPLICATION_LOCAL=trust
POSTGRES_AUTH_REPLICATION_HOST=md5
POSTGRES_AUTH_DOCKER_NETWORKS=md5

# PostgreSQL HBA Networks (Docker networks)
POSTGRES_ALLOWED_NETWORKS="172.16.0.0/12,172.18.0.0/16,192.168.0.0/16,10.0.0.0/8"

# =============================================================================
# Additional MinIO Configuration from minio.conf
# =============================================================================
# Server Configuration
MINIO_ADDRESS=:9000
MINIO_CONSOLE_ADDRESS=:9001
MINIO_VOLUMES=/data

# Logging Configuration
MINIO_LOG_LEVEL=info
MINIO_LOG_FILE=/var/log/minio/minio.log

# Cache Configuration
MINIO_CACHE_DRIVES=""
MINIO_CACHE_EXPIRY=90h
MINIO_CACHE_QUOTA=80%
MINIO_CACHE_EXCLUDE="*.pdf;*.doc;*.docx"

# Compression Configuration
MINIO_COMPRESS=true
MINIO_COMPRESS_MIME_TYPES="text/*,application/javascript,application/json,application/xml"

# Browser Configuration
MINIO_BROWSER=true

# =============================================================================
# Additional Trino Configuration from config files
# =============================================================================
# JVM Configuration (jvm.config)
TRINO_JVM_XMX=2G
TRINO_JVM_GC=UseG1GC
TRINO_JVM_G1_HEAP_REGION_SIZE=32M
TRINO_JVM_EXIT_ON_OOM=true
TRINO_JVM_USE_GC_OVERHEAD_LIMIT=true
TRINO_JVM_NIO_MAX_CACHED_BUFFER_SIZE=2000000
TRINO_JVM_ALLOW_ATTACH_SELF=true

# Node Configuration (node.properties)
TRINO_NODE_ENVIRONMENT=production
TRINO_NODE_DATA_DIR=/data
TRINO_NODE_ID=coordinator1

# Logging Configuration (log.properties)
TRINO_LOG_LEVEL_ROOT=INFO
TRINO_LOG_LEVEL_SERVER=INFO
TRINO_LOG_LEVEL_EXECUTION=INFO
TRINO_LOG_LEVEL_METADATA=INFO
TRINO_LOG_LEVEL_SECURITY=INFO
TRINO_LOG_LEVEL_SPI=INFO
TRINO_LOG_LEVEL_SQL=INFO
TRINO_LOG_LEVEL_TRANSACTION=INFO
TRINO_LOG_LEVEL_TYPE=INFO
TRINO_LOG_LEVEL_UTIL=INFO
TRINO_LOG_LEVEL_HTTP_REQUEST=INFO

# =============================================================================
# Additional Spark Configuration from spark-env.sh
# =============================================================================
# Spark Environment Variables
SPARK_HOME=/opt/spark
JAVA_HOME=/opt/java/openjdk
SPARK_CONF_DIR=/opt/spark/conf
SPARK_LOG_DIR=/var/log/spark
SPARK_PID_DIR=/var/run/spark

# Spark Worker Configuration
SPARK_WORKER_DIR=/tmp/spark-worker
SPARK_WORKER_WEBUI_PORT=8081
SPARK_DAEMON_MEMORY=3g
SPARK_DAEMON_JAVA_OPTS="-Dspark.deploy.recoveryMode=ZOOKEEPER"

# Spark Logging Configuration
SPARK_LOG4J_ROOT_LOGGER=INFO,console
SPARK_LOG4J_CONSOLE=org.apache.log4j.ConsoleAppender
SPARK_LOG4J_CONSOLE_LAYOUT=org.apache.log4j.PatternLayout
SPARK_LOG4J_CONSOLE_LAYOUT_PATTERN="%d{yy/MM/dd HH:mm:ss} %p %c{1}: %m%n"
TRINO_CATALOG_ICEBERG_CATALOG_TYPE=nessie
TRINO_CATALOG_ICEBERG_REST_CATALOG_URI=http://nessie:19120/iceberg/v1/main/
TRINO_CATALOG_ICEBERG_REST_CATALOG_WAREHOUSE=s3://lakehouse/
TRINO_CATALOG_ICEBERG_CATALOG_TYPE=nessie
TRINO_CATALOG_ICEBERG_REST_CATALOG_URI=http://nessie:19120/api/v2
TRINO_ICEBERG_CATALOG_TYPE=nessie
TRINO_ICEBERG_REST_URI=http://nessie:19120/api/v2
TRINO_ICEBERG_WAREHOUSE_DIR=s3://lakehouse/
TRINO_ICEBERG_REF=main
TRINO_ICEBERG_FILE_FORMAT=PARQUET
TRINO_ICEBERG_COMPRESSION_CODEC=SNAPPY
