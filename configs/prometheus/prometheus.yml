# Prometheus Configuration
# Version: 3.8.0 (verified Nov 28, 2025)
global:
  scrape_interval: 15s
  evaluation_interval: 15s

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - "docker-alertmanager:9093"
      timeout: 10s
      api_version: v2

# Load alert rules
rule_files:
  - "/etc/prometheus/alerts.yml"

scrape_configs:
  # Prometheus self-monitoring
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  # MinIO Metrics
  - job_name: "minio"
    static_configs:
      - targets: ["docker-minio:9000"]
    metrics_path: "/minio/v2/metrics/cluster"
    scrape_interval: 30s

  # Nessie Metrics
  - job_name: "nessie"
    static_configs:
      - targets: ["docker-nessie:19120"]
    metrics_path: "/q/metrics"
    scrape_interval: 30s

  # Trino Metrics
  - job_name: "trino"
    static_configs:
      - targets: ["docker-trino:8080"]
    metrics_path: "/v1/info"
    scrape_interval: 30s

  # Spark Master Metrics
  - job_name: "spark-master"
    static_configs:
      - targets: ["docker-spark-master:4040"]
    metrics_path: "/metrics/json"
    scrape_interval: 30s

  # Spark Worker Metrics
  - job_name: "spark-worker"
    static_configs:
      - targets: ["docker-spark-worker:8081"]
    metrics_path: "/metrics/json"
    scrape_interval: 30s

  # PostgreSQL HA - Patroni Node 1 (Primary)
  - job_name: "patroni-1"
    static_configs:
      - targets: ["docker-postgresql-patroni-1:8008"]
    metrics_path: "/metrics"
    scrape_interval: 10s
    basic_auth:
      username: "patroni"
      password: "patroni123"

  # PostgreSQL HA - Patroni Node 2 (Replica)
  - job_name: "patroni-2"
    static_configs:
      - targets: ["docker-postgresql-patroni-2:8008"]
    metrics_path: "/metrics"
    scrape_interval: 10s
    basic_auth:
      username: "patroni"
      password: "patroni123"

  # etcd Cluster Metrics
  - job_name: "etcd"
    static_configs:
      - targets:
          - "docker-etcd-1:2379"
          - "docker-etcd-2:2379"
          - "docker-etcd-3:2379"
    metrics_path: "/metrics"
    scrape_interval: 15s
