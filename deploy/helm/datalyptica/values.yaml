# Datalyptica Data Platform Helm Chart Values

# Global configuration
global:
  # Image registry for all services
  imageRegistry: localhost:5001
  # Image pull policy
  imagePullPolicy: Never # Use 'IfNotPresent' for production
  # Storage class for persistent volumes
  storageClass: standard
  # Environment name
  environment: local

# Namespace configuration
namespaces:
  core: datalyptica-core
  apps: datalyptica-apps
  monitoring: datalyptica-monitoring

# ============================================================
# CORE SERVICES
# ============================================================

# PostgreSQL Configuration
postgresql:
  enabled: true
  image:
    repository: datalyptica/postgresql
    tag: latest
  replicas: 1
  auth:
    postgresPassword: "" # Auto-generated if empty
    database: datalyptica
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 2Gi
      cpu: 1000m
  persistence:
    enabled: true
    size: 10Gi
  securityContext:
    fsGroup: 999
    runAsUser: 999
    runAsNonRoot: true

# Redis Configuration
redis:
  enabled: true
  image:
    repository: datalyptica/redis
    tag: latest
  auth:
    password: "" # Auto-generated if empty
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m
  persistence:
    enabled: true
    size: 5Gi
  securityContext:
    fsGroup: 999
    runAsUser: 999
    runAsNonRoot: true

# MinIO Configuration
minio:
  enabled: true
  image:
    repository: datalyptica/minio
    tag: latest
  replicas: 1
  auth:
    rootUser: minioadmin
    rootPassword: "" # Auto-generated if empty
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 2Gi
      cpu: 1000m
  persistence:
    enabled: true
    size: 20Gi
  securityContext:
    fsGroup: 1000
    runAsUser: 1000
    runAsNonRoot: true
  service:
    type: ClusterIP
    apiPort: 9000
    consolePort: 9001

# Nessie Configuration
nessie:
  enabled: true
  image:
    repository: datalyptica/nessie
    tag: latest
  replicas: 1
  config:
    versionStoreType: JDBC
    catalogDefaultWarehouse: s3://lakehouse/
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 2Gi
      cpu: 1000m
  securityContext:
    fsGroup: 10001
    runAsUser: 10001
    runAsNonRoot: true
  service:
    type: ClusterIP
    port: 19120

# ============================================================
# APPLICATION SERVICES
# ============================================================

# Trino Configuration
trino:
  enabled: true
  image:
    repository: datalyptica/trino
    tag: latest
  coordinator:
    replicas: 1
    resources:
      requests:
        memory: 2Gi
        cpu: 500m
      limits:
        memory: 8Gi
        cpu: 2000m
  worker:
    replicas: 2
    resources:
      requests:
        memory: 2Gi
        cpu: 500m
      limits:
        memory: 8Gi
        cpu: 2000m
  config:
    queryMaxMemory: 4GB
    queryMaxMemoryPerNode: 2GB
  securityContext:
    fsGroup: 1000
    runAsUser: 1000
    runAsNonRoot: true
  service:
    type: ClusterIP
    port: 8080

# Flink Configuration
flink:
  enabled: true
  image:
    repository: datalyptica/flink
    tag: latest
  jobmanager:
    replicas: 1
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 4Gi
        cpu: 2000m
  taskmanager:
    replicas: 2
    resources:
      requests:
        memory: 2Gi
        cpu: 1000m
      limits:
        memory: 8Gi
        cpu: 4000m
    numberOfTaskSlots: 2
  config:
    parallelismDefault: 2
  securityContext:
    fsGroup: 9999
    runAsUser: 9999
    runAsNonRoot: true
  service:
    type: ClusterIP
    rpcPort: 6123
    webuiPort: 8081

# Kafka Configuration
kafka:
  enabled: true
  image:
    repository: datalyptica/kafka
    tag: latest
  replicas: 1
  config:
    autoCreateTopics: true
    offsetsTopicReplicationFactor: 1
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 4Gi
      cpu: 2000m
  persistence:
    enabled: true
    size: 10Gi
  securityContext:
    fsGroup: 1000
    runAsUser: 1000
    runAsNonRoot: true
  service:
    type: ClusterIP
    port: 9092
    internalPort: 9093

# Schema Registry Configuration
schemaRegistry:
  enabled: true
  image:
    repository: confluentinc/cp-schema-registry
    tag: 7.6.0
  replicas: 1
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 1Gi
      cpu: 1000m
  service:
    type: ClusterIP
    port: 8085

# Spark Configuration
spark:
  enabled: true
  image:
    repository: datalyptica/spark
    tag: latest
  master:
    replicas: 1
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 4Gi
        cpu: 2000m
  worker:
    replicas: 2
    cores: 2
    memory: 4g
    resources:
      requests:
        memory: 2Gi
        cpu: 1000m
      limits:
        memory: 6Gi
        cpu: 3000m
  securityContext:
    fsGroup: 1000
    runAsUser: 1000
    runAsNonRoot: true
  service:
    type: ClusterIP
    rpcPort: 7077
    webuiPort: 4040

# ClickHouse Configuration
clickhouse:
  enabled: true
  image:
    repository: datalyptica/clickhouse
    tag: latest
  replicas: 1
  auth:
    username: default
    password: "" # Auto-generated if empty
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 8Gi
      cpu: 4000m
  persistence:
    enabled: true
    size: 20Gi
  securityContext:
    fsGroup: 101
    runAsUser: 101
    runAsNonRoot: true
  service:
    type: ClusterIP
    httpPort: 8123
    nativePort: 9000

# Airflow Configuration
airflow:
  enabled: true
  image:
    repository: datalyptica/airflow
    tag: latest
  executor: CeleryExecutor
  webserver:
    replicas: 1
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 4Gi
        cpu: 2000m
  scheduler:
    replicas: 1
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 4Gi
        cpu: 2000m
  worker:
    replicas: 2
    resources:
      requests:
        memory: 2Gi
        cpu: 1000m
      limits:
        memory: 8Gi
        cpu: 4000m
  auth:
    secretKey: "" # Auto-generated if empty
  securityContext:
    fsGroup: 50000
    runAsUser: 50000
    runAsNonRoot: true
  service:
    type: ClusterIP
    port: 8082

# Superset Configuration
superset:
  enabled: true
  image:
    repository: datalyptica/superset
    tag: latest
  replicas: 1
  auth:
    secretKey: "" # Auto-generated if empty
    adminPassword: "" # Auto-generated if empty
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 4Gi
      cpu: 2000m
  securityContext:
    fsGroup: 1000
    runAsUser: 1000
    runAsNonRoot: true
  service:
    type: ClusterIP
    port: 8088

# ============================================================
# MONITORING SERVICES (Optional)
# ============================================================

# Prometheus Configuration
prometheus:
  enabled: false
  image:
    repository: prom/prometheus
    tag: latest
  replicas: 1
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 2Gi
      cpu: 1000m
  securityContext:
    fsGroup: 65534
    runAsUser: 65534
    runAsNonRoot: true
  service:
    type: ClusterIP
    port: 9090

# Grafana Configuration
grafana:
  enabled: false
  image:
    repository: grafana/grafana
    tag: latest
  replicas: 1
  auth:
    adminPassword: "" # Auto-generated if empty
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 1Gi
      cpu: 500m
  securityContext:
    fsGroup: 472
    runAsUser: 472
    runAsNonRoot: true
  service:
    type: ClusterIP
    port: 3000

# ============================================================
# NETWORK POLICIES
# ============================================================

networkPolicies:
  enabled: false
  policyTypes:
    - Ingress
    - Egress

# ============================================================
# INGRESS CONFIGURATION
# ============================================================

ingress:
  enabled: false
  className: nginx
  annotations: {}
  hosts:
    - host: datalyptica.local
      paths:
        - path: /
          pathType: Prefix
          service: trino-coordinator
          port: 8080
  tls: []

# ============================================================
# SERVICE ACCOUNTS AND RBAC
# ============================================================

serviceAccount:
  create: true
  annotations: {}
  name: ""

rbac:
  create: true
