{{- if .Values.postgresql.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: postgresql-credentials
  namespace: {{ .Values.namespaces.core }}
  labels:
    {{- include "datalyptica.labels" . | nindent 4 }}
type: Opaque
stringData:
  postgres-password: {{ include "datalyptica.password" (dict "password" .Values.postgresql.auth.postgresPassword) | quote }}
  airflow-password: {{ include "datalyptica.password" (dict "password" "") | quote }}
  superset-password: {{ include "datalyptica.password" (dict "password" "") | quote }}
  mlflow-password: {{ include "datalyptica.password" (dict "password" "") | quote }}
  nessie-password: {{ include "datalyptica.password" (dict "password" "") | quote }}
---
apiVersion: v1
kind: Secret
metadata:
  name: postgresql-credentials
  namespace: {{ .Values.namespaces.apps }}
  labels:
    {{- include "datalyptica.labels" . | nindent 4 }}
type: Opaque
stringData:
  postgres-password: {{ include "datalyptica.password" (dict "password" .Values.postgresql.auth.postgresPassword) | quote }}
  airflow-password: {{ include "datalyptica.password" (dict "password" "") | quote }}
  superset-password: {{ include "datalyptica.password" (dict "password" "") | quote }}
{{- end }}

{{- if .Values.redis.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: redis-credentials
  namespace: {{ .Values.namespaces.core }}
  labels:
    {{- include "datalyptica.labels" . | nindent 4 }}
type: Opaque
stringData:
  redis-password: {{ include "datalyptica.password" (dict "password" .Values.redis.auth.password) | quote }}
---
apiVersion: v1
kind: Secret
metadata:
  name: redis-credentials
  namespace: {{ .Values.namespaces.apps }}
  labels:
    {{- include "datalyptica.labels" . | nindent 4 }}
type: Opaque
stringData:
  redis-password: {{ include "datalyptica.password" (dict "password" .Values.redis.auth.password) | quote }}
{{- end }}

{{- if .Values.minio.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: minio-credentials
  namespace: {{ .Values.namespaces.core }}
  labels:
    {{- include "datalyptica.labels" . | nindent 4 }}
type: Opaque
stringData:
  root-user: {{ .Values.minio.auth.rootUser | quote }}
  root-password: {{ include "datalyptica.password" (dict "password" .Values.minio.auth.rootPassword) | quote }}
  access-key: {{ randAlphaNum 20 | b64enc | quote }}
  secret-key: {{ randAlphaNum 40 | b64enc | quote }}
---
apiVersion: v1
kind: Secret
metadata:
  name: minio-credentials
  namespace: {{ .Values.namespaces.apps }}
  labels:
    {{- include "datalyptica.labels" . | nindent 4 }}
type: Opaque
stringData:
  root-user: {{ .Values.minio.auth.rootUser | quote }}
  root-password: {{ include "datalyptica.password" (dict "password" .Values.minio.auth.rootPassword) | quote }}
  access-key: {{ randAlphaNum 20 | b64enc | quote }}
  secret-key: {{ randAlphaNum 40 | b64enc | quote }}
{{- end }}

{{- if .Values.clickhouse.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: clickhouse-credentials
  namespace: {{ .Values.namespaces.apps }}
  labels:
    {{- include "datalyptica.labels" . | nindent 4 }}
type: Opaque
stringData:
  username: {{ .Values.clickhouse.auth.username | quote }}
  password: {{ include "datalyptica.password" (dict "password" .Values.clickhouse.auth.password) | quote }}
{{- end }}

{{- if .Values.airflow.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: airflow-credentials
  namespace: {{ .Values.namespaces.apps }}
  labels:
    {{- include "datalyptica.labels" . | nindent 4 }}
type: Opaque
stringData:
  secret-key: {{ include "datalyptica.password" (dict "password" .Values.airflow.auth.secretKey) | b64enc | quote }}
{{- end }}

{{- if .Values.superset.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: superset-credentials
  namespace: {{ .Values.namespaces.apps }}
  labels:
    {{- include "datalyptica.labels" . | nindent 4 }}
type: Opaque
stringData:
  secret-key: {{ include "datalyptica.password" (dict "password" .Values.superset.auth.secretKey) | b64enc | quote }}
  admin-password: {{ include "datalyptica.password" (dict "password" .Values.superset.auth.adminPassword) | quote }}
{{- end }}

{{- if .Values.grafana.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: grafana-credentials
  namespace: {{ .Values.namespaces.monitoring }}
  labels:
    {{- include "datalyptica.labels" . | nindent 4 }}
type: Opaque
stringData:
  admin-password: {{ include "datalyptica.password" (dict "password" .Values.grafana.auth.adminPassword) | quote }}
{{- end }}
