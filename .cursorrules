# ShuDL (Shugur Data Lakehouse Platform) - Copilot Instructions

## ğŸ¯ **Project Overview**

**ShuDL** is a comprehensive on-premises Data Lakehouse Platform that provides a turn-key solution combining the economics of data lakes with the performance and governance of data warehouses. The platform bundles proven open-source components (Apache Iceberg, Project Nessie, Trino, Spark, MinIO, PostgreSQL) with a modern web-based installer and management portal.

**Current Status**: Phase 1B Complete âœ… - Enhanced Data Platform Configurator with visual component selection, dependency mapping, real-time validation, and configuration export/import. **FULLY FUNCTIONAL AUTOMATED STACK** with all required integrations and CLI working properly.

**Strategic Vision**: Transform ShuDL into a comprehensive, enterprise-grade Data Platform that combines the simplicity of Docker deployment with the scalability of Kubernetes-native solutions, positioning it as the "Stackable alternative" that's easier to get started with but scales to enterprise needs.

## ğŸ—ï¸ **Architecture & Technology Stack**

### **Core Components**
- **Apache Iceberg 1.9.1**: Table format with ACID transactions
- **Project Nessie 0.104.2**: Git-like data catalog with versioning
- **MinIO**: S3-compatible object storage
- **PostgreSQL 16**: Metadata store with optional Patroni HA
- **Trino 448**: Distributed SQL query engine
- **Apache Spark 3.5**: Big data processing framework
- **Prometheus/Grafana**: Monitoring and observability

### **Platform Architecture**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MinIO S3      â”‚    â”‚   PostgreSQL    â”‚    â”‚   Nessie        â”‚
â”‚   Object Store  â”‚    â”‚   + Patroni     â”‚    â”‚   Catalog       â”‚
â”‚   (Port 9000)   â”‚    â”‚   (Port 5432)   â”‚    â”‚   (Port 19120)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Trino         â”‚    â”‚   Spark         â”‚    â”‚   Lakehouse     â”‚
â”‚   Query Engine  â”‚    â”‚   Compute       â”‚    â”‚   Manager       â”‚
â”‚   (Port 8080)   â”‚    â”‚   (Port 4040)   â”‚    â”‚   Portal        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ **Current Implementation Status**

### **âœ… Completed Features (Phase 1A & 1B)**

#### **Phase 1A: Core Infrastructure**
- âœ… **Web-based Installer**: Go backend with Gin framework
- âœ… **REST API**: Complete API for deployment management
- âœ… **CLI Tool**: `shudlctl` command-line interface
- âœ… **Docker Integration**: Dynamic compose file generation
- âœ… **Environment Management**: 160+ configurable parameters
- âœ… **Service Orchestration**: Multi-service deployment and management

#### **Phase 1B: Enhanced Data Platform Configurator**
- âœ… **Visual Component Selection**: Drag-and-drop service builder
- âœ… **Service Palette**: Organized services by category (Storage, Compute, Monitoring)
- âœ… **Canvas Management**: Visual workspace for building data platform stacks
- âœ… **Dependency Mapping**: SVG-based dependency visualization
- âœ… **Real-time Validation**: Live configuration validation with immediate feedback
- âœ… **Configuration Export/Import**: JSON template management
- âœ… **Preset Management**: Save and load configuration presets

### **ğŸ”§ Technical Implementation**

#### **Backend (Go)**
- **Framework**: Gin web framework
- **Architecture**: Modular design with handlers, services, models
- **API**: RESTful endpoints for Docker management, configuration, validation
- **CLI**: Cobra-based `shudlctl` command-line tool
- **Configuration**: Dynamic generation of `docker-compose.yml` and `.env` files

#### **Frontend (HTML/CSS/JavaScript)**
- **UI Framework**: Vanilla JavaScript with modular components
- **Styling**: Custom CSS with modern design patterns
- **Interactions**: HTML5 drag-and-drop, SVG graphics, real-time updates
- **Validation**: Client-side validation with server integration

#### **Docker & Deployment**
- **Container Images**: Custom `ghcr.io/shugur-network/shudl/*` images
- **Orchestration**: Docker Compose with dynamic configuration
- **Networking**: Custom networks with proper hostname resolution
- **Health Checks**: Comprehensive service health monitoring

## ğŸ“ **Project Structure**

```
shudl/
â”œâ”€â”€ cmd/                          # Go applications
â”‚   â”œâ”€â”€ installer/               # Web installer backend
â”‚   â””â”€â”€ shudlctl/               # CLI tool
â”œâ”€â”€ internal/                    # Internal Go packages
â”‚   â”œâ”€â”€ api/                    # API handlers and models
â”‚   â”œâ”€â”€ cli/                    # CLI command implementations
â”‚   â”œâ”€â”€ pkg/                    # Shared utilities
â”‚   â””â”€â”€ services/               # Business logic services
â”œâ”€â”€ web/                        # Frontend assets
â”‚   â”œâ”€â”€ src/                    # JavaScript source files
â”‚   â”œâ”€â”€ static/                 # Static assets
â”‚   â””â”€â”€ templates/              # HTML templates
â”œâ”€â”€ docker/                     # Docker service definitions
â”œâ”€â”€ generated/                  # Generated configuration files
â”œâ”€â”€ bin/                        # Built executables
â”œâ”€â”€ scripts/                    # Utility scripts
â””â”€â”€ docs/                       # Documentation
```

## ğŸ¯ **Strategic Roadmap (5-Phase Enhancement Plan)**

### **Phase 1: Foundation Enhancement (4-6 weeks) - âœ… COMPLETE**
*Goal: Strengthen core platform with Stackable-inspired improvements*

#### **1.1 CLI Tool Development (`shudlctl`) - âœ… COMPLETE**
- âœ… **Core Commands**: `deploy`, `status`, `logs` (fully functional)
- âœ… **Enhanced Commands**: `install`, `upgrade`, `backup`, `config`, `validate`, `template`
- âœ… **Service Management**: `start`, `stop`, `restart`, `scale`
- âœ… **Advanced Features**: Configuration management, template system

#### **1.2 Enhanced Web Configurator - âœ… COMPLETE**
- âœ… **Visual Component Selection**: Drag-and-drop interface
- âœ… **Dependency Mapping**: SVG-based service relationships
- âœ… **Real-time Validation**: Live configuration checks
- âœ… **Export/Import**: Configuration templates
- âœ… **Deployment Wizard**: Step-by-step guidance

#### **1.3 Monitoring & Observability Stack - âœ… COMPLETE**
- âœ… **Prometheus**: Metrics collection
- âœ… **Grafana**: Dashboards and visualization
- âœ… **Alertmanager**: System alerts
- âœ… **Structured Logging**: Centralized log management
- âœ… **Health Checks**: Comprehensive service monitoring

#### **1.4 Enhanced Documentation Hub - âœ… COMPLETE**
- âœ… **Getting Started**: Quick deployment guides
- âœ… **API Documentation**: Comprehensive API reference
- âœ… **Best Practices**: Production deployment guides
- âœ… **Migration Guides**: Version upgrade paths

### **Phase 2: Ecosystem Expansion (6-8 weeks) - PLANNED**
*Goal: Broaden supported tools to match Stackable's ecosystem*

#### **2.1 Stream Processing Layer**
- ğŸ”§ **Apache Kafka**: Message streaming platform
- ğŸ”§ **Apache NiFi**: Data ingestion and routing
- ğŸ”§ **Kafka Connect**: External system integration
- ğŸ”§ **Real-time Pipelines**: Stream processing templates

#### **2.2 Orchestration & Workflow**
- ğŸ”§ **Apache Airflow**: Workflow orchestration
- ğŸ”§ **Pre-built DAGs**: Common data operations
- ğŸ”§ **Spark Integration**: Seamless job orchestration
- ğŸ”§ **Pipeline Monitoring**: Workflow observability

#### **2.3 Analytics & Visualization**
- ğŸ”§ **Apache Superset**: Data visualization platform
- ğŸ”§ **JupyterHub**: Data science workflows
- ğŸ”§ **Pre-configured Dashboards**: Ready-to-use analytics
- ğŸ”§ **Notebook Templates**: Data exploration guides

#### **2.4 Data Quality & Governance**
- ğŸ”§ **Data Validation**: Automated quality checks
- ğŸ”§ **Schema Registry**: Data contract management
- ğŸ”§ **Access Controls**: Role-based permissions
- ğŸ”§ **Data Lineage**: Track data flow and transformations

### **Phase 3: Kubernetes Native (8-10 weeks) - PLANNED**
*Goal: Add Kubernetes deployment alongside Docker*

#### **3.1 ShuDL Kubernetes Operator**
- ğŸ”§ **Custom Resources**: ShuDL-specific CRDs
- ğŸ”§ **Automated Operations**: Deployment, scaling, updates
- ğŸ”§ **Self-Healing**: Automatic recovery and maintenance
- ğŸ”§ **Resource Management**: Optimal resource allocation

#### **3.2 Helm Charts Collection**
- ğŸ”§ **Complete Chart Library**: All ShuDL components
- ğŸ”§ **Configurable Values**: Environment-specific settings
- ğŸ”§ **Multi-Cloud Support**: AWS, GCP, Azure deployment guides
- ğŸ”§ **Upgrade Strategies**: Zero-downtime updates

#### **3.3 Multi-Environment Support**
- âœ… **Docker Compose**: Simple development/testing
- ğŸ”§ **Kubernetes**: Enterprise scalable deployment
- ğŸ”§ **Bare Metal**: On-premises direct installation
- ğŸ”§ **Cloud Native**: Optimized cloud deployments

### **Phase 4: Data Mesh & Enterprise Features (10-12 weeks) - PLANNED**
*Goal: Position ShuDL as enterprise Data Mesh platform*

#### **4.1 Data Mesh Architecture**
- ğŸ”§ **Domain-Oriented**: Data ownership patterns
- ğŸ”§ **Self-Serve Platform**: Developer-friendly tools
- ğŸ”§ **Federated Governance**: Distributed data management
- ğŸ”§ **Data Products**: Catalog and discovery

#### **4.2 Security & Governance**
- ğŸ”§ **Apache Ranger**: Fine-grained access control
- ğŸ”§ **Keycloak**: Identity and access management
- ğŸ”§ **Policy as Code**: Automated governance
- ğŸ”§ **Audit Trails**: Comprehensive activity logging

#### **4.3 Commercial Service Models**
- âœ… **ShuDL Community**: Free, self-hosted version
- ğŸ”§ **ShuDL Enterprise**: Paid with enterprise features
- ğŸ”§ **ShuDL Managed**: Fully managed cloud service
- ğŸ”§ **Professional Services**: Implementation and consulting

### **Phase 5: Advanced Platform Features (12+ weeks) - PLANNED**
*Goal: Differentiate from Stackable with unique innovations*

#### **5.1 AI/ML Integration**
- ğŸ”§ **MLflow**: Complete ML lifecycle management
- ğŸ”§ **Model Serving**: Production ML model deployment
- ğŸ”§ **Feature Store**: Centralized feature management
- ğŸ”§ **AutoML Pipelines**: Automated model training

#### **5.2 Advanced Data Lake Features**
- ğŸ”§ **Real-time Ingestion**: High-throughput data pipelines
- ğŸ”§ **Change Data Capture**: Live database replication
- ğŸ”§ **Multi-table Transactions**: Complex data operations
- ğŸ”§ **Automatic Optimization**: Self-tuning performance

#### **5.3 Developer Experience**
- ğŸ”§ **ShuDL SDK**: Multi-language client libraries
- ğŸ”§ **Interactive Playground**: Browser-based tutorials
- ğŸ”§ **Local Development**: Lightweight dev environment
- ğŸ”§ **Testing Framework**: Data pipeline testing tools

## ğŸ¯ **Development Guidelines**

### **Code Style & Standards**

#### **Go (Backend)**
- **Package Structure**: Follow Go module conventions
- **Error Handling**: Use structured error handling with custom error types
- **Logging**: Structured logging with context and levels
- **API Design**: RESTful principles with proper HTTP status codes
- **Configuration**: Environment-based configuration with validation
- **Testing**: Unit tests with high coverage, integration tests for APIs

#### **JavaScript (Frontend)**
- **Modular Architecture**: Component-based design with clear separation
- **Error Handling**: Comprehensive error handling with user feedback
- **Performance**: Debounced operations, efficient DOM manipulation
- **Accessibility**: ARIA labels, keyboard navigation support
- **Responsive Design**: Mobile-first approach with modern CSS

#### **Docker & Infrastructure**
- **Container Design**: Non-root containers, minimal base images
- **Security**: Proper credential management, network isolation
- **Monitoring**: Health checks, logging, metrics collection
- **Configuration**: Environment variables over hardcoded values
- **Networking**: Proper hostname resolution, service discovery

### **Key Development Principles**

1. **Environment Variables First**: Always use environment variables for configuration, never hardcode values
2. **Dynamic Hostnames**: Services should use configurable hostnames, not hardcoded ones
3. **Simple Container Names**: Use simple service names (e.g., `nessie`) without project prefixes
4. **Comprehensive Validation**: Real-time validation with detailed feedback
5. **User Experience**: Intuitive interfaces with clear visual feedback
6. **Error Handling**: Graceful error handling with helpful error messages
7. **Testing**: Comprehensive testing at all levels (unit, integration, e2e)
8. **Stackable-Inspired**: Learn from Stackable's approach while maintaining ShuDL's simplicity

### **Configuration Management**

#### **Environment Variables**
- **Database**: `POSTGRES_HOST`, `POSTGRES_DB`, `POSTGRES_USER`, `POSTGRES_PASSWORD`
- **Object Storage**: `MINIO_ROOT_USER`, `MINIO_ROOT_PASSWORD`, `MINIO_BUCKET`
- **Catalog**: `NESSIE_URI`, `NESSIE_REF`, `NESSIE_AUTH_TYPE`
- **Compute**: `TRINO_PORT`, `SPARK_MASTER_URL`, `SPARK_WORKER_CORES`
- **Security**: `KEYCLOAK_URL`, `RANGER_ADMIN_PASSWORD`
- **Monitoring**: `PROMETHEUS_PORT`, `GRAFANA_PORT`, `LOKI_PORT`

#### **Dynamic Configuration Generation**
- **Docker Compose**: Generated from service selections and configuration
- **Environment Files**: Dynamic `.env` file generation with proper variable substitution
- **Service Dependencies**: Automatic dependency resolution and ordering
- **Network Configuration**: Dynamic network creation and service attachment

## ğŸš€ **Deployment & Operations**

### **Deployment Models**

#### **Docker Compose (Current)**
- **Single Node**: All services on one host
- **Multi-Node**: Distributed across multiple hosts
- **HA Setup**: High availability with Patroni, MinIO erasure coding

#### **Kubernetes (Planned - Phase 3)**
- **Helm Charts**: Complete Kubernetes deployment
- **Operator Pattern**: Custom controllers for lifecycle management
- **Multi-Cluster**: Cross-cluster replication and management

### **Service Management**

#### **Web Installer**
- **URL**: http://localhost:8080
- **Features**: Visual configuration, deployment management, monitoring
- **API**: RESTful API for all operations

#### **CLI Tool (`shudlctl`)**
```bash
# Deploy services
./bin/shudlctl deploy --services postgresql,minio,nessie --yes

# Check status
./bin/shudlctl status

# View logs
docker logs nessie

# Validate system
./bin/shudlctl deploy --validate
```

### **Monitoring & Observability**

#### **Health Checks**
- **Service Health**: Individual service health monitoring
- **Dependency Checks**: Service dependency validation
- **Resource Monitoring**: CPU, memory, disk usage
- **Network Connectivity**: Inter-service communication validation

#### **Logging**
- **Structured Logging**: JSON format with correlation IDs
- **Log Levels**: DEBUG, INFO, WARN, ERROR
- **Log Aggregation**: Centralized log collection and analysis
- **Audit Trail**: Security and compliance logging

## ğŸ¯ **Current Focus Areas**

### **Immediate Priorities (Phase 1 Completion)**
1. âœ… **Fix CLI Issues**: Resolved `shudlctl deploy` and `shudlctl status` 500 errors
2. âœ… **Complete Service Integration**: All services start and communicate properly
3. âœ… **Enhanced Validation**: Real-time validation with better error messages
4. âœ… **Documentation**: Complete API documentation and user guides
5. âœ… **Monitoring Stack**: Added Prometheus/Grafana to Docker Compose
6. âœ… **CLI Enhancement**: Complete `shudlctl` command set

### **Next Phase (Phase 2 - Ecosystem Expansion)**
1. **Stream Processing**: Add Kafka, NiFi, Kafka Connect
2. **Orchestration**: Integrate Apache Airflow
3. **Analytics**: Add Apache Superset and JupyterHub
4. **Data Quality**: Implement validation and governance features

### **Long-term Roadmap (Phase 3-5)**
1. **Kubernetes Support**: Complete K8s deployment and management
2. **Data Mesh**: Enterprise Data Mesh platform features
3. **AI/ML Integration**: Advanced analytics capabilities
4. **Commercial Services**: Enterprise and managed service offerings

## ğŸ”§ **Development Workflow**

### **Local Development**
```bash
# Start the installer
go run cmd/installer/main.go

# Build the CLI
go build -o bin/shudlctl cmd/shudlctl/main.go

# Run tests
go test ./...

# Generate configuration
curl -X POST -H "Content-Type: application/json" \
  -d '{"project_name":"test","services":{"postgresql":{"enabled":true}}}' \
  http://localhost:8080/api/v1/compose/generate
```

### **Testing Strategy**
1. **Unit Tests**: Go tests for all packages
2. **Integration Tests**: API endpoint testing
3. **End-to-End Tests**: Complete deployment workflows
4. **Performance Tests**: Load testing and benchmarking

### **Quality Assurance**
1. **Code Review**: All changes require review
2. **Automated Testing**: CI/CD pipeline with comprehensive tests
3. **Documentation**: Keep documentation up-to-date
4. **Security**: Regular security audits and updates

## ğŸ¯ **Success Metrics**

### **Technical Metrics**
- **Deployment Time**: < 5 minutes for basic stack (Stackable-inspired target)
- **Service Uptime**: > 99.9% availability
- **Query Performance**: < 5 seconds for typical queries
- **Resource Usage**: Efficient resource utilization

### **User Experience Metrics**
- **Ease of Use**: Intuitive web interface (simpler than Stackable)
- **Configuration Time**: < 10 minutes for basic setup
- **Error Resolution**: Clear error messages and guidance
- **Documentation**: Comprehensive and up-to-date guides
- **CLI Adoption**: 80% of users prefer CLI over web (Stackable target)

### **Business Metrics**
- **Community Growth**: 1000+ GitHub stars
- **Enterprise Adoption**: 10+ paying customers
- **Market Position**: Top 3 in "Data Lakehouse Platforms"
- **Competitive Advantage**: Easier than Stackable, more comprehensive than alternatives

## ğŸš€ **Getting Started**

### **For Developers**
1. **Clone Repository**: `git clone https://github.com/Shugur-Network/shudl.git`
2. **Install Dependencies**: `go mod download`
3. **Start Installer**: `go run cmd/installer/main.go`
4. **Access Web UI**: http://localhost:8080
5. **Build CLI**: `go build -o bin/shudlctl cmd/shudlctl/main.go`

### **For Users**
1. **Download Release**: Get the latest release from GitHub
2. **Run Installer**: Execute the web installer
3. **Configure Services**: Use the visual configurator
4. **Deploy Platform**: Start the deployment process
5. **Access Services**: Use the provided service endpoints

---

**Remember**: This is a living document. Update it as the project evolves and new features are implemented. Always prioritize user experience, security, and reliability in all development decisions. The goal is to position ShuDL as the "Stackable alternative" that's easier to get started with but scales to enterprise needs. 