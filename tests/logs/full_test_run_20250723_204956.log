
===============================================================================
[0;35mğŸ—ï¸  ShuDL Data Lakehouse - Test Suite[0m
===============================================================================
ğŸ• Started: Wed Jul 23 20:49:56 UTC 2025
ğŸ“‚ Working Directory: /home/ubuntu/shudl
ğŸ“‹ Log Directory: /home/ubuntu/shudl/tests/logs
ğŸ¯ Category: all
âš¡ Quick Mode: false
ğŸ“¢ Verbose: true
===============================================================================

[0;36m[20:49:56][0m Phase 1: Prerequisites and Environment Validation
[0;36m[20:49:56][0m Running test: Environment Variables
[0;35m==== Environment Variables Validation ====[0m
[0;34mâ„¹ï¸  Loading docker/.env file...[0m
[0;36mğŸ”„ Checking required environment variables...[0m
[0;34mâ„¹ï¸  âœ“ COMPOSE_PROJECT_NAME = shudl[0m
[0;34mâ„¹ï¸  âœ“ NETWORK_NAME = shunetwork[0m
[0;34mâ„¹ï¸  âœ“ POSTGRES_DB = nessie[0m
[0;34mâ„¹ï¸  âœ“ POSTGRES_USER = nessie[0m
[0;34mâ„¹ï¸  âœ“ POSTGRES_PASSWORD = nessie123[0m
[0;34mâ„¹ï¸  âœ“ POSTGRES_PORT = 5432[0m
[0;34mâ„¹ï¸  âœ“ MINIO_ROOT_USER = admin[0m
[0;34mâ„¹ï¸  âœ“ MINIO_ROOT_PASSWORD = password123[0m
[0;34mâ„¹ï¸  âœ“ MINIO_API_PORT = 9000[0m
[0;34mâ„¹ï¸  âœ“ MINIO_CONSOLE_PORT = 9001[0m
[0;34mâ„¹ï¸  âœ“ MINIO_BUCKET_NAME = lakehouse[0m
[0;34mâ„¹ï¸  âœ“ MINIO_REGION = us-east-1[0m
[0;34mâ„¹ï¸  âœ“ S3_ENDPOINT = http://minio:9000[0m
[0;34mâ„¹ï¸  âœ“ S3_ACCESS_KEY = admin[0m
[0;34mâ„¹ï¸  âœ“ S3_SECRET_KEY = password123[0m
[0;34mâ„¹ï¸  âœ“ S3_REGION = us-east-1[0m
[0;34mâ„¹ï¸  âœ“ S3_PATH_STYLE_ACCESS = true[0m
[0;34mâ„¹ï¸  âœ“ NESSIE_PORT = 19120[0m
[0;34mâ„¹ï¸  âœ“ NESSIE_HOST = 0.0.0.0[0m
[0;34mâ„¹ï¸  âœ“ NESSIE_VERSION_STORE_TYPE = JDBC2[0m
[0;34mâ„¹ï¸  âœ“ NESSIE_WAREHOUSE_LOCATION = s3://lakehouse/[0m
[0;34mâ„¹ï¸  âœ“ WAREHOUSE_LOCATION = s3://lakehouse/[0m
[0;34mâ„¹ï¸  âœ“ TRINO_PORT = 8080[0m
[0;34mâ„¹ï¸  âœ“ TRINO_COORDINATOR = true[0m
[0;34mâ„¹ï¸  âœ“ TRINO_INCLUDE_COORDINATOR = true[0m
[0;34mâ„¹ï¸  âœ“ TRINO_NODE_ENVIRONMENT = production[0m
[0;34mâ„¹ï¸  âœ“ TRINO_QUERY_MAX_MEMORY = 2GB[0m
[0;34mâ„¹ï¸  âœ“ TRINO_CATALOG_ICEBERG_CATALOG_TYPE = nessie[0m
[0;34mâ„¹ï¸  âœ“ TRINO_CATALOG_ICEBERG_NESSIE_CATALOG_URI = http://nessie:19120/api/v2[0m
[0;34mâ„¹ï¸  âœ“ SPARK_UI_PORT = 4040[0m
[0;34mâ„¹ï¸  âœ“ SPARK_MASTER_PORT = 7077[0m
[0;34mâ„¹ï¸  âœ“ SPARK_MASTER_URL = spark://shudl-spark-master:7077[0m
[0;34mâ„¹ï¸  âœ“ SPARK_DRIVER_MEMORY = 2g[0m
[0;34mâ„¹ï¸  âœ“ SPARK_EXECUTOR_MEMORY = 2g[0m
[0;34mâ„¹ï¸  âœ“ SPARK_ICEBERG_CATALOG_NAME = iceberg[0m
[0;34mâ„¹ï¸  âœ“ SPARK_ICEBERG_URI = http://nessie:19120/api/v2[0m
[0;34mâ„¹ï¸  âœ“ SPARK_HADOOP_FS_S3A_ENDPOINT = http://minio:9000[0m
[0;34mâ„¹ï¸  âœ“ SPARK_HADOOP_FS_S3A_ACCESS_KEY = admin[0m
[0;34mâ„¹ï¸  âœ“ SPARK_HADOOP_FS_S3A_SECRET_KEY = password123[0m
[0;36mğŸ”„ Validating environment variable values...[0m
[0;36mğŸ”„ Checking for port conflicts...[0m
[0;34mâ„¹ï¸  âœ“ PostgreSQL using port 5432[0m
[0;34mâ„¹ï¸  âœ“ MinIO Console using port 9001[0m
[0;34mâ„¹ï¸  âœ“ Spark UI using port 4040[0m
[0;34mâ„¹ï¸  âœ“ MinIO API using port 9000[0m
[0;34mâ„¹ï¸  âœ“ Spark Master using port 7077[0m
[0;34mâ„¹ï¸  âœ“ Nessie using port 19120[0m
[0;34mâ„¹ï¸  âœ“ Trino using port 8080[0m
[0;36mğŸ”„ Validating URI formats...[0m
[0;32mâœ… All environment variables are properly configured (0s)[0m
[0;32mâœ… Environment Variables completed in 0s[0m
[0;36m[20:49:56][0m Running test: Docker Compose Validation
[0;35m==== Docker Compose Validation ====[0m
[0;36mğŸ”„ Checking docker/docker-compose.yml exists...[0m
[0;36mğŸ”„ Validating docker-compose.yml syntax...[0m
[0;36mğŸ”„ Checking required services...[0m
[0;34mâ„¹ï¸  âœ“ Service 'postgresql' found[0m
[0;34mâ„¹ï¸  âœ“ Service 'minio' found[0m
[0;34mâ„¹ï¸  âœ“ Service 'nessie' found[0m
[0;34mâ„¹ï¸  âœ“ Service 'trino' found[0m
[0;34mâ„¹ï¸  âœ“ Service 'spark-master' found[0m
[0;34mâ„¹ï¸  âœ“ Service 'spark-worker' found[0m
[0;36mğŸ”„ Validating service dependencies...[0m
[1;33mâš ï¸  Spark master service should have dependencies defined[0m
[0;36mğŸ”„ Checking network configuration...[0m
[0;36mğŸ”„ Validating health checks...[0m
[1;33mâš ï¸  Service 'postgresql' missing health check configuration[0m
[1;33mâš ï¸  Service 'minio' missing health check configuration[0m
[1;33mâš ï¸  Service 'nessie' missing health check configuration[0m
[0;34mâ„¹ï¸  âœ“ Service 'trino' has health check configured[0m
[1;33mâš ï¸  Service 'spark-master' missing health check configuration[0m
[0;34mâ„¹ï¸  âœ“ Service 'spark-worker' has health check configured[0m
[0;36mğŸ”„ Checking volume mounts...[0m
[1;33mâš ï¸  MinIO should have volume mounts for data persistence[0m
[0;36mğŸ”„ Validating environment variables mapping...[0m
[1;33mâš ï¸  Environment variable 'POSTGRES_PASSWORD' may not be properly mapped[0m
[1;33mâš ï¸  Environment variable 'MINIO_ROOT_PASSWORD' may not be properly mapped[0m
[1;33mâš ï¸  Environment variable 'TRINO_PORT' may not be properly mapped[0m
[1;33mâš ï¸  Environment variable 'SPARK_MASTER_PORT' may not be properly mapped[0m
[0;32mâœ… Docker Compose configuration is valid (3s)[0m
[0;32mâœ… Docker Compose Validation completed in 3s[0m
[0;36m[20:49:59][0m Phase 2: Service Health Checks
[0;36m[20:49:59][0m Running test: PostgreSQL Health
[0;35m==== PostgreSQL Health Check ====[0m
[0;36mğŸ”„ Checking PostgreSQL container status...[0m
[0;36mğŸ”„ Testing PostgreSQL port connectivity...[0m
[0;36mğŸ”„ Testing PostgreSQL authentication...[0m
 ?column? 
----------
        1
(1 row)

[0;36mğŸ”„ Checking Nessie database exists...[0m
[0;36mğŸ”„ Testing database operations...[0m
CREATE TABLE
INSERT 0 1
DROP TABLE
[0;36mğŸ”„ Checking PostgreSQL configuration...[0m
[0;36mğŸ”„ Checking disk space...[0m
[0;32mâœ… PostgreSQL is healthy and operational (0s)[0m
[0;32mâœ… PostgreSQL Health completed in 0s[0m
[0;36m[20:49:59][0m Running test: MinIO Health
[0;35m==== MinIO Health Check ====[0m
[0;36mğŸ”„ Checking MinIO container status...[0m
[0;36mğŸ”„ Testing MinIO API port connectivity...[0m
[0;36mğŸ”„ Testing MinIO Console port connectivity...[0m
[0;36mğŸ”„ Testing MinIO API health endpoint...[0m
[0;36mğŸ”„ Testing bucket operations...[0m
[0;34mâ„¹ï¸  âœ“ Lakehouse bucket accessible[0m
[0;34mâ„¹ï¸  âœ“ File upload successful[0m
[0;34mâ„¹ï¸  âœ“ File download and content verification successful[0m
[0;36mğŸ”„ Checking storage information...[0m
[1;33mâš ï¸  Cannot retrieve storage information[0m
[0;36mğŸ”„ Validating MinIO configuration...[0m
[0;34mâ„¹ï¸  âœ“ S3 API is responding (access control working)[0m
[0;32mâœ… MinIO is healthy and operational (1s)[0m
[0;32mâœ… MinIO Health completed in 1s[0m
[0;36m[20:50:00][0m Running test: Nessie Health
[0;35m==== Nessie Health Check ====[0m
[0;36mğŸ”„ Checking Nessie container status...[0m
[0;36mğŸ”„ Testing Nessie port connectivity...[0m
[0;36mğŸ”„ Testing Nessie API endpoints...[0m
[0;36mğŸ”„ Verifying Nessie service health...[0m
[0;34mâ„¹ï¸  âœ“ Nessie is responding correctly to API requests[0m
[0;36mğŸ”„ Checking Nessie configuration...[0m
[0;34mâ„¹ï¸  âœ“ Default branch: main[0m
[0;36mğŸ”„ Testing branch operations...[0m
[0;34mâ„¹ï¸  âœ“ Found 1 branches[0m
[0;34mâ„¹ï¸  âœ“ Main branch exists[0m
[0;36mğŸ”„ Testing namespace operations...[0m
[0;34mâ„¹ï¸  âœ“ Found 2 entries in main branch[0m
[0;36mğŸ”„ Testing database connectivity...[0m
[1;33mâš ï¸  Cannot confirm Nessie startup from logs[0m
[0;36mğŸ”„ Validating API version...[0m
[1;33mâš ï¸  Cannot retrieve API version information[0m
[0;32mâœ… Nessie is healthy and operational (0s)[0m
[0;32mâœ… Nessie Health completed in 0s[0m
[0;36m[20:50:00][0m Running test: Trino Health
[0;35m==== Trino Health Check ====[0m
[0;36mğŸ”„ Checking Trino container status...[0m
[0;36mğŸ”„ Testing Trino port connectivity...[0m
[0;36mğŸ”„ Testing Trino REST API...[0m
[0;36mğŸ”„ Checking Trino cluster info...[0m
[0;34mâ„¹ï¸  âœ“ Trino cluster info accessible[0m
[0;34mâ„¹ï¸  âœ“ Trino version: 476[0m
[0;36mğŸ”„ Testing basic SQL queries...[0m
